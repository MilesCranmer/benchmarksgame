<!DOCTYPE html>
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="robots" content="noindex,follow,noarchive">

<title>pidigits Ada 2012 GNAT&nbsp;#2 program | Computer Language Benchmarks Game </title>
<style><!--
a{color:black;text-decoration:none}article{padding:0 0 2.9em}article,div,footer,header{margin:auto;width:92%}body{font:100% Droid Sans, Ubuntu, Verdana, sans-serif;margin:0;-webkit-text-size-adjust:100%}h3, h1, h2, li a{font-family:Ubuntu Mono,Consolas,Menlo,monospace}div,footer,header{max-width:31em}footer{padding:2.6em 0 0}h3{font-size:1.4em;font-weight:bold;margin:0;padding: .4em}h3, h3 a{color:white;background-color:#dd4814}h3 small{font-size:0.64em}h1,h2{margin:1.5em 0 0}h1{font-size:1.4em;font-weight:normal}h2{font-size:1.2em}li{list-style-type:none;vertical-align:top}li a{display:block;font-size:1.2em;margin: .5em .5em 0;padding: .5em .5em .3em}ul{clear:left;margin:-0.3em 0 1.5em;padding-left:0;text-align:center}p{color:#333;line-height:1.4;margin: .3em 0 0}p a, a span{border-bottom: .1em solid #333;padding-bottom: .1em}.com,.slc{color:#888}.kwa{color:#066}.kwb{color:#900}.kwc{color:#050}.kwa,.kwb,.kwc{font-weight:bold}.dstr,.str,.sym,.num{color:#930}pre{color:#222;font-size:1em;overflow-wrap:break-word;white-space:pre-wrap;word-wrap:break-word}@media only screen and (min-width: 60em){article,footer,header{font-size:1.25em}}
--></style>
<link rel="shortcut icon" href="./favicon.ico">
<header>
  <h3><a href="https://benchmarksgame-team.pages.debian.net/benchmarksgame/">The&nbsp;<small>Computer&nbsp;Language</small><br>Benchmarks&nbsp;Game</a></h3>
</header>
<article>
  <div>
    <h1>pidigits Ada 2012 GNAT&nbsp;#2 program</h1>
    <aside>
      <p><a href="../description/pidigits.html#pidigits">description</a>
    </aside>
  </div>
  <section>
    </div>
      <h2>source code</h2>
    </div>
    <pre>
<span class="slc">--  The Computer Language Benchmarks Game</span>
<span class="slc">--  https://salsa.debian.org/benchmarksgame-team/benchmarksgame/</span>
<span class="slc">--  Calculate digits of pi using the</span>
<span class="slc">--  Unbounded Spigot Algorithms</span>
<span class="slc">--</span>
<span class="slc">--  Contributed by Brian Kolden</span>
<span class="slc">--  gmp headers by Karl-Michael Schindler and Brian Kolden</span>
<span class="slc">--  Port of Mr Ledrug&apos;s pidigits</span>

<span class="kwa">with</span> Ada<span class="opt">.</span>Command_Line<span class="opt">;</span>    <span class="kwa">use</span> Ada<span class="opt">.</span>Command_Line<span class="opt">;</span>

<span class="kwa">with</span> Interfaces<span class="opt">.</span>C<span class="opt">;</span>

<span class="kwa">procedure</span> Pidigits <span class="kwa">is</span>

  <span class="kwa">pragma</span> Suppress<span class="opt">(</span>All_Checks<span class="opt">);</span>

  <span class="kwa">package</span> GMP_Mini <span class="kwa">is</span>
  	Print_String <span class="opt">:</span> <span class="kwa">constant</span> <span class="kwb">String</span> <span class="opt">:=</span> ASCII<span class="opt">.</span>HT <span class="opt">&amp;</span> <span class="str">&quot;:%d&quot;</span> <span class="opt">&amp;</span> ASCII<span class="opt">.</span>LF <span class="opt">&amp;</span> ASCII<span class="opt">.</span>NUL<span class="opt">;</span>

    <span class="kwa">type</span> mp_limb_t <span class="kwa">is new</span> Interfaces<span class="opt">.</span>C<span class="opt">.</span>unsigned<span class="opt">;</span>
    <span class="kwa">type</span> mp_ptr <span class="kwa">is access</span> mp_limb_t<span class="opt">;</span>

    <span class="kwa">type</span> mpz_t <span class="kwa">is record</span>
      mp_alloc<span class="opt">,</span> mp_size <span class="opt">:</span> Interfaces<span class="opt">.</span>C<span class="opt">.</span>int<span class="opt">;</span>
      mp_d    <span class="opt">:</span> mp_ptr<span class="opt">;</span>
    <span class="kwa">end record</span><span class="opt">;</span>

    <span class="kwa">procedure</span> mpz_init <span class="opt">(</span>Dest<span class="opt">:</span> <span class="kwa">out</span> mpz_t<span class="opt">)</span> <span class="kwa">with</span> Inline<span class="opt">=&gt;</span><span class="kwd">True</span><span class="opt">;</span>
    <span class="kwa">pragma</span> Import<span class="opt">(</span>C<span class="opt">,</span> mpz_init<span class="opt">,</span> <span class="str">&quot;__gmpz_init&quot;</span><span class="opt">);</span>

    <span class="kwa">procedure</span> mpz_init_set_ui <span class="opt">(</span>Dest<span class="opt">:</span> <span class="kwa">out</span> mpz_t<span class="opt">;</span> Src<span class="opt">:</span> <span class="kwa">in</span> Interfaces<span class="opt">.</span>C<span class="opt">.</span>unsigned_long<span class="opt">)</span> <span class="kwa">with</span> Inline<span class="opt">=&gt;</span><span class="kwd">True</span><span class="opt">;</span>
    <span class="kwa">pragma</span> Import<span class="opt">(</span>C<span class="opt">,</span> mpz_init_set_ui<span class="opt">,</span> <span class="str">&quot;__gmpz_init_set_ui&quot;</span><span class="opt">);</span>

    <span class="kwa">procedure</span> mpz_mul_ui <span class="opt">(</span>Dest<span class="opt">:</span> <span class="kwa">out</span> mpz_t<span class="opt">;</span> Src1<span class="opt">:</span> <span class="kwa">in</span> mpz_t<span class="opt">;</span> Src2<span class="opt">:</span> <span class="kwa">in</span> Interfaces<span class="opt">.</span>C<span class="opt">.</span>unsigned_long<span class="opt">)</span> <span class="kwa">with</span> Inline<span class="opt">=&gt;</span><span class="kwd">True</span><span class="opt">;</span>
    <span class="kwa">pragma</span> Import<span class="opt">(</span>C<span class="opt">,</span> mpz_mul_ui<span class="opt">,</span> <span class="str">&quot;__gmpz_mul_ui&quot;</span><span class="opt">);</span>

    <span class="kwa">procedure</span> mpz_add <span class="opt">(</span>Dest<span class="opt">:</span> <span class="kwa">out</span> mpz_t<span class="opt">;</span> Src1<span class="opt">,</span> Src2<span class="opt">:</span> <span class="kwa">in</span> mpz_t<span class="opt">)</span> <span class="kwa">with</span> Inline<span class="opt">=&gt;</span><span class="kwd">True</span><span class="opt">;</span>
    <span class="kwa">pragma</span> Import<span class="opt">(</span>C<span class="opt">,</span> mpz_add<span class="opt">,</span> <span class="str">&quot;__gmpz_add&quot;</span><span class="opt">);</span>

    <span class="kwa">procedure</span> mpz_addmul_ui <span class="opt">(</span>Dest<span class="opt">:</span> <span class="kwa">out</span> mpz_t<span class="opt">;</span> Src1<span class="opt">:</span> <span class="kwa">in</span> mpz_t<span class="opt">;</span> Src2<span class="opt">:</span> <span class="kwa">in</span> Interfaces<span class="opt">.</span>C<span class="opt">.</span>unsigned<span class="opt">)</span> <span class="kwa">with</span> Inline<span class="opt">=&gt;</span><span class="kwd">True</span><span class="opt">;</span>
    <span class="kwa">pragma</span> Import<span class="opt">(</span>C<span class="opt">,</span> mpz_addmul_ui<span class="opt">,</span> <span class="str">&quot;__gmpz_addmul_ui&quot;</span><span class="opt">);</span>

    <span class="kwa">procedure</span> mpz_submul_ui <span class="opt">(</span>Dest<span class="opt">:</span> <span class="kwa">out</span> mpz_t<span class="opt">;</span> Src1<span class="opt">:</span> <span class="kwa">in</span> mpz_t<span class="opt">;</span> Src2<span class="opt">:</span> <span class="kwa">in</span> Interfaces<span class="opt">.</span>C<span class="opt">.</span>unsigned<span class="opt">)</span> <span class="kwa">with</span> Inline<span class="opt">=&gt;</span><span class="kwd">True</span><span class="opt">;</span>
    <span class="kwa">pragma</span> Import<span class="opt">(</span>C<span class="opt">,</span> mpz_submul_ui<span class="opt">,</span> <span class="str">&quot;__gmpz_submul_ui&quot;</span><span class="opt">);</span>

    <span class="kwa">procedure</span> mpz_tdiv_q <span class="opt">(</span>Dest<span class="opt">:</span> <span class="kwa">out</span> mpz_t<span class="opt">;</span> Src1<span class="opt">,</span> Src2<span class="opt">:</span> <span class="kwa">in</span> mpz_t<span class="opt">)</span> <span class="kwa">with</span> Inline<span class="opt">=&gt;</span><span class="kwd">True</span><span class="opt">;</span>
    <span class="kwa">pragma</span> Import<span class="opt">(</span>C<span class="opt">,</span> mpz_tdiv_q<span class="opt">,</span> <span class="str">&quot;__gmpz_tdiv_q&quot;</span><span class="opt">);</span>

    <span class="kwa">function</span> mpz_get_ui <span class="opt">(</span>Src<span class="opt">:</span> <span class="kwa">in</span> mpz_t<span class="opt">)</span> <span class="kwa">return</span> Interfaces<span class="opt">.</span>C<span class="opt">.</span>unsigned_long <span class="kwa">with</span> Inline<span class="opt">=&gt;</span><span class="kwd">True</span><span class="opt">;</span>
    <span class="kwa">pragma</span> Import<span class="opt">(</span>C<span class="opt">,</span> mpz_get_ui<span class="opt">,</span> <span class="str">&quot;__gmpz_get_ui&quot;</span><span class="opt">);</span>

    <span class="kwa">function</span> mpz_cmp <span class="opt">(</span>Src<span class="opt">:</span> <span class="kwa">in</span> mpz_t<span class="opt">;</span> Ref<span class="opt">:</span> <span class="kwa">in</span> mpz_t<span class="opt">)</span> <span class="kwa">return</span> Interfaces<span class="opt">.</span>C<span class="opt">.</span>int <span class="kwa">with</span> Inline<span class="opt">=&gt;</span><span class="kwd">True</span><span class="opt">;</span>
    <span class="kwa">pragma</span> Import<span class="opt">(</span>C<span class="opt">,</span> mpz_cmp<span class="opt">,</span> <span class="str">&quot;__gmpz_cmp&quot;</span><span class="opt">);</span>

    <span class="kwa">procedure</span> Put_Char <span class="opt">(</span>Val <span class="opt">:</span> <span class="kwa">in</span> Interfaces<span class="opt">.</span>C<span class="opt">.</span>unsigned<span class="opt">)</span> <span class="kwa">with</span> Inline<span class="opt">=&gt;</span><span class="kwd">True</span><span class="opt">;</span>
    <span class="kwa">pragma</span> Import<span class="opt">(</span>C<span class="opt">,</span> Put_Char<span class="opt">,</span> <span class="str">&quot;putchar&quot;</span><span class="opt">);</span>

    <span class="kwa">procedure</span> Put_Line <span class="opt">(</span>Format <span class="opt">:</span> <span class="kwa">in</span> <span class="kwb">String</span><span class="opt">;</span> Data <span class="opt">:</span> <span class="kwa">in</span> Interfaces<span class="opt">.</span>C<span class="opt">.</span>unsigned<span class="opt">)</span> <span class="kwa">with</span> Inline<span class="opt">=&gt;</span><span class="kwd">True</span><span class="opt">;</span>
    <span class="kwa">pragma</span> Import<span class="opt">(</span>C<span class="opt">,</span> Put_Line<span class="opt">,</span> <span class="str">&quot;printf&quot;</span><span class="opt">);</span>

    <span class="kwa">pragma</span> Linker_Options<span class="opt">(</span><span class="str">&quot;-lgmp&quot;</span><span class="opt">);</span>

  <span class="kwa">end</span> GMP_Mini<span class="opt">;</span>
  <span class="kwa">use</span> GMP_Mini<span class="opt">;</span>

  Tmp1<span class="opt">,</span> Tmp2<span class="opt">,</span> Acc<span class="opt">,</span> Den<span class="opt">,</span> Num <span class="opt">:</span> mpz_t<span class="opt">;</span>

  <span class="kwa">function</span> Extract<span class="opt">(</span>X<span class="opt">:</span> Interfaces<span class="opt">.</span>C<span class="opt">.</span>Unsigned_long<span class="opt">)</span> <span class="kwa">return</span> Interfaces<span class="opt">.</span>C<span class="opt">.</span>unsigned <span class="kwa">with</span> Inline<span class="opt">=&gt;</span><span class="kwd">True</span><span class="opt">;</span>
  <span class="kwa">function</span> Extract<span class="opt">(</span>X<span class="opt">:</span> Interfaces<span class="opt">.</span>C<span class="opt">.</span>Unsigned_long<span class="opt">)</span> <span class="kwa">return</span> Interfaces<span class="opt">.</span>C<span class="opt">.</span>unsigned <span class="kwa">is</span>
  <span class="kwa">begin</span>
    mpz_mul_ui<span class="opt">(</span>Tmp1<span class="opt">,</span> Num<span class="opt">,</span> X<span class="opt">);</span>
    mpz_add<span class="opt">(</span>Tmp2<span class="opt">,</span> Tmp1<span class="opt">,</span> Acc<span class="opt">);</span>
    mpz_tdiv_q<span class="opt">(</span>Tmp1<span class="opt">,</span> Tmp2<span class="opt">,</span> Den<span class="opt">);</span>
    <span class="kwa">return</span> Interfaces<span class="opt">.</span>C<span class="opt">.</span>unsigned<span class="opt">(</span>mpz_get_ui<span class="opt">(</span>Tmp1<span class="opt">));</span>
  <span class="kwa">end</span> Extract<span class="opt">;</span>

  <span class="kwa">procedure</span> Eliminate <span class="opt">(</span>D <span class="opt">:</span> <span class="kwa">in</span> Interfaces<span class="opt">.</span>C<span class="opt">.</span>unsigned<span class="opt">)</span> <span class="kwa">with</span> Inline<span class="opt">=&gt;</span><span class="kwd">True</span><span class="opt">;</span>
  <span class="kwa">procedure</span> Eliminate <span class="opt">(</span>D <span class="opt">:</span> <span class="kwa">in</span> Interfaces<span class="opt">.</span>C<span class="opt">.</span>unsigned<span class="opt">)</span> <span class="kwa">is</span>
  <span class="kwa">begin</span>
    mpz_submul_ui<span class="opt">(</span>Acc<span class="opt">,</span> Den<span class="opt">,</span> D<span class="opt">);</span>
    mpz_mul_ui<span class="opt">(</span>Acc<span class="opt">,</span> Acc<span class="opt">,</span> <span class="num">10</span><span class="opt">);</span>
    mpz_mul_ui<span class="opt">(</span>Num<span class="opt">,</span> Num<span class="opt">,</span> <span class="num">10</span><span class="opt">);</span>
  <span class="kwa">end</span> Eliminate<span class="opt">;</span>

  <span class="kwa">procedure</span> Consume <span class="opt">(</span>K <span class="opt">:</span> <span class="kwa">in</span> Interfaces<span class="opt">.</span>C<span class="opt">.</span>unsigned<span class="opt">)</span> <span class="kwa">with</span> Inline<span class="opt">=&gt;</span><span class="kwd">True</span><span class="opt">;</span>
  <span class="kwa">procedure</span> Consume <span class="opt">(</span>K <span class="opt">:</span> <span class="kwa">in</span> Interfaces<span class="opt">.</span>C<span class="opt">.</span>unsigned<span class="opt">)</span> <span class="kwa">is</span>
    <span class="kwa">use</span> Interfaces<span class="opt">.</span>C<span class="opt">;</span>
    K2 <span class="opt">:</span> unsigned<span class="opt">;</span>
  <span class="kwa">begin</span>
    K2 <span class="opt">:=</span> K <span class="opt">*</span> <span class="num">2</span> <span class="opt">+</span> <span class="num">1</span><span class="opt">;</span>

    mpz_addmul_ui<span class="opt">(</span>Acc<span class="opt">,</span> Num<span class="opt">,</span> <span class="num">2</span><span class="opt">);</span>
    mpz_mul_ui<span class="opt">(</span>Acc<span class="opt">,</span> Acc<span class="opt">,</span> unsigned_long<span class="opt">(</span>K2<span class="opt">));</span>
    mpz_mul_ui<span class="opt">(</span>Den<span class="opt">,</span> Den<span class="opt">,</span> unsigned_long<span class="opt">(</span>K2<span class="opt">));</span>
    mpz_mul_ui<span class="opt">(</span>Num<span class="opt">,</span> Num<span class="opt">,</span> unsigned_long<span class="opt">(</span>K<span class="opt">));</span>
  <span class="kwa">end</span> Consume<span class="opt">;</span>


  N <span class="opt">:</span> Interfaces<span class="opt">.</span>C<span class="opt">.</span>unsigned<span class="opt">;</span>

<span class="kwa">begin</span>
  N <span class="opt">:=</span> <span class="num">2</span>_500<span class="opt">;</span>
  <span class="kwa">if</span> Argument_Count<span class="opt">=</span><span class="num">1</span> <span class="kwa">then</span>
    N <span class="opt">:=</span> Interfaces<span class="opt">.</span>C<span class="opt">.</span>unsigned<span class="kwd">&apos;Value</span><span class="opt">(</span>Argument<span class="opt">(</span><span class="num">1</span><span class="opt">));</span>
  <span class="kwa">end if</span><span class="opt">;</span>

  mpz_init<span class="opt">(</span>Tmp1<span class="opt">);</span>
  mpz_init<span class="opt">(</span>Tmp2<span class="opt">);</span>

  mpz_init_set_ui<span class="opt">(</span>Acc<span class="opt">,</span> <span class="num">0</span><span class="opt">);</span>
  mpz_init_set_ui<span class="opt">(</span>Den<span class="opt">,</span> <span class="num">1</span><span class="opt">);</span>
  mpz_init_set_ui<span class="opt">(</span>Num<span class="opt">,</span> <span class="num">1</span><span class="opt">);</span>

  <span class="kwa">declare</span>
    <span class="kwa">use</span> Interfaces<span class="opt">.</span>C<span class="opt">;</span>
    D<span class="opt">,</span> K<span class="opt">,</span> I <span class="opt">:</span> Interfaces<span class="opt">.</span>C<span class="opt">.</span>unsigned <span class="opt">:=</span> <span class="num">0</span><span class="opt">;</span>
  <span class="kwa">begin</span>
    <span class="opt">&lt;&lt;</span>Work_Loop<span class="opt">&gt;&gt;</span>
    <span class="kwa">while</span> I <span class="opt">&lt;</span> N <span class="kwa">loop</span>
      K <span class="opt">:=</span> K <span class="opt">+</span> <span class="num">1</span><span class="opt">;</span>
      Consume<span class="opt">(</span>K<span class="opt">);</span>

      <span class="kwa">if</span> mpz_cmp<span class="opt">(</span>Num<span class="opt">,</span> Acc<span class="opt">) &gt;</span> <span class="num">0</span> <span class="kwa">then</span>
        <span class="kwa">goto</span> Work_Loop<span class="opt">;</span>
      <span class="kwa">end if</span><span class="opt">;</span>

      D <span class="opt">:=</span> Extract<span class="opt">(</span><span class="num">3</span><span class="opt">);</span>
      <span class="kwa">if</span> D <span class="opt">/=</span> Extract<span class="opt">(</span><span class="num">4</span><span class="opt">)</span> <span class="kwa">then</span> 
        <span class="kwa">goto</span> Work_Loop<span class="opt">;</span>
      <span class="kwa">end if</span><span class="opt">;</span>

      Put_Char<span class="opt">(</span>D <span class="opt">+</span> <span class="num">48</span><span class="opt">);</span>
      I <span class="opt">:=</span> I <span class="opt">+</span> <span class="num">1</span><span class="opt">;</span>
      <span class="kwa">if</span> I <span class="kwa">rem</span> <span class="num">10</span> <span class="opt">=</span> <span class="num">0</span> <span class="kwa">then</span>
        Put_Line<span class="opt">(</span>Print_String<span class="opt">,</span> I<span class="opt">);</span>
      <span class="kwa">end if</span><span class="opt">;</span>
      Eliminate<span class="opt">(</span>D<span class="opt">);</span>

    <span class="kwa">end loop</span><span class="opt">;</span>
  <span class="kwa">end</span><span class="opt">;</span>

<span class="kwa">end</span> Pidigits<span class="opt">;</span>
    </pre>
  </section>
  <section>
    <h2 id="log">notes, command-line, and program output</h2>
    <pre>
NOTES:
64-bit Ubuntu quad core
GNATMAKE 8.2.0
gcc (Ubuntu 8.2.0-7ubuntu1) 8.2.0



Wed, 09 Jan 2019 16:34:08 GMT

MAKE:
gnatchop -r -w pidigits.gnat-2.gnat
splitting pidigits.gnat-2.gnat into:
   pidigits.adb
gnatmake -O3 -fomit-frame-pointer -march=native -msse3 -mfpmath=sse -gnatNp -f pidigits.adb -o pidigits.gnat-2.gnat_run 
x86_64-linux-gnu-gcc-8 -c -O3 -fomit-frame-pointer -march=native -msse3 -mfpmath=sse -gnatNp pidigits.adb
x86_64-linux-gnu-gnatbind-8 -x pidigits.ali
x86_64-linux-gnu-gnatlink-8 pidigits.ali -O3 -fomit-frame-pointer -march=native -msse3 -mfpmath=sse -o pidigits.gnat-2.gnat_run

3.74s to complete and log all make actions

COMMAND LINE:
./pidigits.gnat-2.gnat_run 27

UNEXPECTED OUTPUT 

3c3
&lt; 6264338
\ No newline at end of file
---
&gt; 6264338   	:27

PROGRAM OUTPUT:
3141592653	:10
5897932384	:20
6264338    </pre>
  </section>
</article>
<footer>
  <nav>
    <ul>
      <li><a href="../license.html"><span>3-Clause BSD License</span></a>
    </ul>
  </nav>
</footer>

