<!DOCTYPE html>
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="robots" content="noindex,follow,noarchive">

<title>pidigits Lisp SBCL&nbsp;#3 program | Computer Language Benchmarks Game </title>
<style><!--
a{color:black;text-decoration:none}article{padding:0 0 2.9em}article,div,footer,header{margin:auto;width:92%}body{font:100% Droid Sans, Ubuntu, Verdana, sans-serif;margin:0;-webkit-text-size-adjust:100%}h3, h1, h2, li a{font-family:Ubuntu Mono,Consolas,Menlo,monospace}div,footer,header{max-width:31em}footer{padding:2.6em 0 0}h3{font-size:1.4em;font-weight:bold;margin:0;padding: .4em}h3, h3 a{color:white;background-color:#dd4814}h3 small{font-size:0.64em}h1,h2{margin:1.5em 0 0}h1{font-size:1.4em;font-weight:normal}h2{font-size:1.2em}li{list-style-type:none;vertical-align:top}li a{display:block;font-size:1.2em;margin: .5em .5em 0;padding: .5em .5em .3em}ul{clear:left;margin:-0.3em 0 1.5em;padding-left:0;text-align:center}p{color:#333;line-height:1.4;margin: .3em 0 0}p a, a span{border-bottom: .1em solid #333;padding-bottom: .1em}.com,.slc{color:#888}.kwa{color:#066}.kwb{color:#900}.kwc{color:#050}.kwa,.kwb,.kwc{font-weight:bold}.dstr,.str,.sym,.num{color:#930}pre{color:#222;font-size:1em;overflow-wrap:break-word;white-space:pre-wrap;word-wrap:break-word}@media only screen and (min-width: 60em){article,footer,header{font-size:1.25em}}
--></style>
<link rel="shortcut icon" href="./favicon.ico">
<header>
  <h3><a href="https://benchmarksgame-team.pages.debian.net/benchmarksgame/">The&nbsp;<small>Computer&nbsp;Language</small><br>Benchmarks&nbsp;Game</a></h3>
</header>
<article>
  <div>
    <h1>pidigits Lisp SBCL&nbsp;#3 program</h1>
    <aside>
      <p><a href="../description/pidigits.html#pidigits">description</a>
    </aside>
  </div>
  <section>
    </div>
      <h2>source code</h2>
    </div>
    <pre>
<span class="slc">;; The Computer Language Benchmarks Game</span>
<span class="slc">;; https://salsa.debian.org/benchmarksgame-team/benchmarksgame/</span>
<span class="slc">;;</span>
<span class="slc">;; adapted from the C version by Kentaro Nakazawa 2016-11-08</span>

<span class="opt">#+</span>sbcl <span class="opt">(</span><span class="kwa">require</span> <span class="opt">:</span>sb-gmp<span class="opt">)</span>		<span class="slc">; GMP disabled when commenting out</span>

<span class="opt">(</span><span class="kwa">declaim</span> <span class="opt">(</span><span class="kwa">optimize</span> <span class="opt">(</span><span class="kwa">speed</span> <span class="num">3</span><span class="opt">) (</span><span class="kwa">debug</span> <span class="num">0</span><span class="opt">) (</span><span class="kwa">space</span> <span class="num">0</span><span class="opt">) (</span><span class="kwa">safety</span> <span class="num">0</span><span class="opt">)))</span>

<span class="opt">(</span><span class="kwa">declaim</span> <span class="opt">(</span><span class="kwa">type</span> integer acc den num<span class="opt">))</span>
<span class="opt">(</span><span class="kwa">defparameter</span> acc <span class="num">0</span><span class="opt">)</span>
<span class="opt">(</span><span class="kwa">defparameter</span> den <span class="num">1</span><span class="opt">)</span>
<span class="opt">(</span><span class="kwa">defparameter</span> num <span class="num">1</span><span class="opt">)</span>

<span class="opt">(</span><span class="kwa">defun</span> <span class="kwb">extract-digit</span> <span class="opt">(</span><span class="kwa">nth</span><span class="opt">)</span>
  <span class="opt">(</span><span class="kwa">declare</span> <span class="opt">(</span><span class="kwa">type</span> fixnum nth<span class="opt">))</span>
  <span class="opt">(</span><span class="kwa">the</span> fixnum <span class="opt">(</span><span class="kwa">truncate</span> <span class="opt">(+ (*</span> num nth<span class="opt">)</span> acc<span class="opt">)</span> den<span class="opt">)))</span>

<span class="opt">(</span><span class="kwa">defun</span> <span class="kwb">eliminate-digit</span> <span class="opt">(</span><span class="kwa">d</span><span class="opt">)</span>
  <span class="opt">(</span><span class="kwa">declare</span> <span class="opt">(</span><span class="kwa">type</span> fixnum d<span class="opt">))</span>
  <span class="opt">(</span><span class="kwa">decf</span> acc <span class="opt">(*</span> den d<span class="opt">))</span>
  <span class="opt">(</span><span class="kwa">setf</span> acc <span class="opt">(*</span> acc <span class="num">10</span><span class="opt">))</span>
  <span class="opt">(</span><span class="kwa">setf</span> num <span class="opt">(*</span> num <span class="num">10</span><span class="opt">)))</span>

<span class="opt">(</span><span class="kwa">defun</span> <span class="kwb">next-term</span> <span class="opt">(</span><span class="kwa">k</span><span class="opt">)</span>
  <span class="opt">(</span><span class="kwa">declare</span> <span class="opt">(</span><span class="kwa">type</span> fixnum k<span class="opt">))</span>
  <span class="opt">(</span><span class="kwa">let</span> <span class="opt">((</span><span class="kwa">k2</span> <span class="opt">(</span><span class="kwa">1</span><span class="opt">+ (*</span> k <span class="num">2</span><span class="opt">))))</span>
    <span class="opt">(</span><span class="kwa">declare</span> <span class="opt">(</span><span class="kwa">type</span> fixnum k2<span class="opt">))</span>
    <span class="opt">(</span><span class="kwa">incf</span> acc <span class="opt">(*</span> num <span class="num">2</span><span class="opt">))</span>
    <span class="opt">(</span><span class="kwa">setf</span> acc <span class="opt">(*</span> acc k2<span class="opt">))</span>
    <span class="opt">(</span><span class="kwa">setf</span> den <span class="opt">(*</span> den k2<span class="opt">))</span>
    <span class="opt">(</span><span class="kwa">setf</span> num <span class="opt">(*</span> num k<span class="opt">))))</span>

<span class="opt">(</span><span class="kwa">defun</span> <span class="kwb">main</span> <span class="opt">()</span>
  <span class="opt">(</span><span class="kwa">do</span> <span class="opt">((</span><span class="kwa">d</span> <span class="num">0</span><span class="opt">) (</span><span class="kwa">k</span> <span class="num">0</span><span class="opt">) (</span><span class="kwa">i</span> <span class="num">0</span><span class="opt">) (</span><span class="kwa">n</span> <span class="num">10000</span><span class="opt">))</span>
      <span class="opt">((&gt;=</span> i n<span class="opt">))</span>
    <span class="opt">(</span><span class="kwa">declare</span> <span class="opt">(</span><span class="kwa">type</span> fixnum d k i n<span class="opt">))</span>
    <span class="opt">(</span><span class="kwa">setf</span> n <span class="opt">(</span><span class="kwa">parse-integer</span> <span class="opt">(</span><span class="kwa">nth</span> <span class="num">1</span> <span class="opt">#+</span>sbcl sb-ext<span class="opt">:*</span>posix-argv<span class="opt">*</span>
				  <span class="opt">#+</span>cmu extensions<span class="opt">:*</span>command-line-strings<span class="opt">*</span>
				  <span class="opt">#+</span>gcl si<span class="opt">::*</span>command-args<span class="opt">*)))</span>
    <span class="opt">(</span><span class="kwa">next-term</span> <span class="opt">(</span><span class="kwa">incf</span> k<span class="opt">))</span>
    <span class="opt">(</span><span class="kwa">when</span> <span class="opt">(&gt;</span> num acc<span class="opt">)</span>
      <span class="opt">(</span><span class="kwa">go</span> continue<span class="opt">))</span>

    <span class="opt">(</span><span class="kwa">setf</span> d <span class="opt">(</span><span class="kwa">extract-digit</span> <span class="num">3</span><span class="opt">))</span>
    <span class="opt">(</span><span class="kwa">when</span> <span class="opt">(/=</span> d <span class="opt">(</span><span class="kwa">extract-digit</span> <span class="num">4</span><span class="opt">))</span>
      <span class="opt">(</span><span class="kwa">go</span> continue<span class="opt">))</span>

    <span class="opt">(</span><span class="kwa">princ</span> d<span class="opt">)</span>
    <span class="opt">(</span><span class="kwa">when</span> <span class="opt">(= (</span><span class="kwa">mod</span> <span class="opt">(</span><span class="kwa">incf</span> i<span class="opt">)</span> <span class="num">10</span><span class="opt">)</span> <span class="num">0</span><span class="opt">)</span>
      <span class="opt">(</span><span class="kwa">format</span> t <span class="str">&quot;~C:~D~%&quot;</span> <span class="opt">#</span>\Tab i<span class="opt">))</span>
    <span class="opt">(</span><span class="kwa">eliminate-digit</span> d<span class="opt">)</span>
   continue<span class="opt">))</span>
    </pre>
  </section>
  <section>
    <h2 id="log">notes, command-line, and program output</h2>
    <pre>
NOTES:
64-bit Ubuntu quad core
SBCL 1.4.13


Wed, 09 Jan 2019 16:26:01 GMT

MAKE:
cp: 'pidigits.sbcl-3.sbcl' and './pidigits.sbcl-3.sbcl' are the same file
SBCL built with: /opt/src/sbcl-1.4.13/bin/sbcl --userinit /dev/null --batch --eval '(load &quot;pidigits.sbcl-3.sbcl_compile&quot;)'
### START pidigits.sbcl-3.sbcl_compile
(handler-bind ((sb-ext:defconstant-uneql      (lambda (c) (abort c))))      (require :sb-concurrency)      (load (compile-file &quot;pidigits.sbcl-3.sbcl&quot; ))) (save-lisp-and-die &quot;sbcl.core&quot; :purify t)
### END pidigits.sbcl-3.sbcl_compile

; compiling file &quot;/home/dunham/8000-benchmarksgame/bench/pidigits/pidigits.sbcl-3.sbcl&quot; (written 26 APR 2018 12:49:15 PM):
; compiling (REQUIRE :SB-GMP)
; compiling (DECLAIM (OPTIMIZE # ...))
; compiling (DECLAIM (TYPE INTEGER ...))
; compiling (DEFPARAMETER ACC ...)
; compiling (DEFPARAMETER DEN ...)
; compiling (DEFPARAMETER NUM ...)
; compiling (DEFUN EXTRACT-DIGIT ...)
; file: /home/dunham/8000-benchmarksgame/bench/pidigits/pidigits.sbcl-3.sbcl
; in: DEFUN EXTRACT-DIGIT
;     (* NUM NTH)
; 
; note: forced to do GENERIC-* (cost 30)
;       unable to do inline fixnum arithmetic (cost 4) because:
;       The first argument is a INTEGER, not a FIXNUM.
;       The result is a (VALUES INTEGER &amp;OPTIONAL), not a (VALUES FIXNUM &amp;REST T).
;       unable to do inline (signed-byte 64) arithmetic (cost 5) because:
;       The first argument is a INTEGER, not a (SIGNED-BYTE 64).
;       The result is a (VALUES INTEGER &amp;OPTIONAL), not a (VALUES
;                                                          (SIGNED-BYTE 64) &amp;REST
;                                                          T).
;       etc.

;     (+ (* NUM NTH) ACC)
; 
; note: forced to do GENERIC-+ (cost 10)
;       unable to do inline fixnum arithmetic (cost 2) because:
;       The first argument is a INTEGER, not a FIXNUM.
;       The second argument is a INTEGER, not a FIXNUM.
;       The result is a (VALUES INTEGER &amp;OPTIONAL), not a (VALUES FIXNUM &amp;REST T).
;       unable to do inline (signed-byte 64) arithmetic (cost 5) because:
;       The first argument is a INTEGER, not a (SIGNED-BYTE 64).
;       The second argument is a INTEGER, not a (SIGNED-BYTE 64).
;       The result is a (VALUES INTEGER &amp;OPTIONAL), not a (VALUES
;                                                          (SIGNED-BYTE 64) &amp;REST
;                                                          T).
;       etc.

; compiling (DEFUN ELIMINATE-DIGIT ...)
; file: /home/dunham/8000-benchmarksgame/bench/pidigits/pidigits.sbcl-3.sbcl
; in: DEFUN ELIMINATE-DIGIT
;     (* DEN D)
; 
; note: forced to do GENERIC-* (cost 30)
;       unable to do inline fixnum arithmetic (cost 4) because:
;       The first argument is a INTEGER, not a FIXNUM.
;       The result is a (VALUES INTEGER &amp;OPTIONAL), not a (VALUES FIXNUM &amp;REST T).
;       unable to do inline (signed-byte 64) arithmetic (cost 5) because:
;       The first argument is a INTEGER, not a (SIGNED-BYTE 64).
;       The result is a (VALUES INTEGER &amp;OPTIONAL), not a (VALUES
;                                                          (SIGNED-BYTE 64) &amp;REST
;                                                          T).
;       etc.

;     (DECF ACC (* DEN D))
; --&gt; SETQ THE SB-IMPL::XSUBTRACT BLOCK 
; ==&gt;
;   (- SB-IMPL::B SB-IMPL::A)
; 
; note: forced to do GENERIC-- (cost 10)
;       unable to do inline fixnum arithmetic (cost 2) because:
;       The first argument is a INTEGER, not a FIXNUM.
;       The second argument is a INTEGER, not a FIXNUM.
;       The result is a (VALUES INTEGER &amp;OPTIONAL), not a (VALUES FIXNUM &amp;REST T).
;       unable to do inline (signed-byte 64) arithmetic (cost 5) because:
;       The first argument is a INTEGER, not a (SIGNED-BYTE 64).
;       The second argument is a INTEGER, not a (SIGNED-BYTE 64).
;       The result is a (VALUES INTEGER &amp;OPTIONAL), not a (VALUES
;                                                          (SIGNED-BYTE 64) &amp;REST
;                                                          T).
;       etc.

;     (* ACC 10)
; 
; note: forced to do GENERIC-* (cost 30)
;       unable to do inline fixnum arithmetic (cost 3) because:
;       The first argument is a INTEGER, not a FIXNUM.
;       The result is a (VALUES INTEGER &amp;OPTIONAL), not a (VALUES FIXNUM &amp;REST T).
;       unable to do inline (signed-byte 64) arithmetic (cost 4) because:
;       The first argument is a INTEGER, not a (SIGNED-BYTE 64).
;       The result is a (VALUES INTEGER &amp;OPTIONAL), not a (VALUES
;                                                          (SIGNED-BYTE 64) &amp;REST
;                                                          T).
;       etc.

;     (* NUM 10)
; 
; note: forced to do GENERIC-* (cost 30)
;       unable to do inline fixnum arithmetic (cost 3) because:
;       The first argument is a INTEGER, not a FIXNUM.
;       The result is a (VALUES INTEGER &amp;OPTIONAL), not a (VALUES FIXNUM &amp;REST T).
;       unable to do inline (signed-byte 64) arithmetic (cost 4) because:
;       The first argument is a INTEGER, not a (SIGNED-BYTE 64).
;       The result is a (VALUES INTEGER &amp;OPTIONAL), not a (VALUES
;                                                          (SIGNED-BYTE 64) &amp;REST
;                                                          T).
;       etc.

; compiling (DEFUN NEXT-TERM ...)
; file: /home/dunham/8000-benchmarksgame/bench/pidigits/pidigits.sbcl-3.sbcl
; in: DEFUN NEXT-TERM
;     (* NUM 2)
; ==&gt;
;   (ASH SB-C::X 1)
; 
; note: forced to do full call
;       unable to do inline ASH (cost 2) because:
;       The first argument is a INTEGER, not a FIXNUM.
;       The result is a (VALUES INTEGER &amp;OPTIONAL), not a (VALUES FIXNUM &amp;REST T).
;       unable to do inline ASH (cost 3) because:
;       The first argument is a INTEGER, not a (UNSIGNED-BYTE 64).
;       The result is a (VALUES INTEGER &amp;OPTIONAL), not a (VALUES
;                                                          (UNSIGNED-BYTE 64)
;                                                          &amp;REST T).
;       etc.

;     (INCF ACC (* NUM 2))
; --&gt; SETQ THE 
; ==&gt;
;   (+ (* NUM 2) ACC)
; 
; note: forced to do GENERIC-+ (cost 10)
;       unable to do inline fixnum arithmetic (cost 2) because:
;       The first argument is a INTEGER, not a FIXNUM.
;       The second argument is a INTEGER, not a FIXNUM.
;       The result is a (VALUES INTEGER &amp;OPTIONAL), not a (VALUES FIXNUM &amp;REST T).
;       unable to do inline (signed-byte 64) arithmetic (cost 5) because:
;       The first argument is a INTEGER, not a (SIGNED-BYTE 64).
;       The second argument is a INTEGER, not a (SIGNED-BYTE 64).
;       The result is a (VALUES INTEGER &amp;OPTIONAL), not a (VALUES
;                                                          (SIGNED-BYTE 64) &amp;REST
;                                                          T).
;       etc.

;     (* ACC K2)
; 
; note: forced to do GENERIC-* (cost 30)
;       unable to do inline fixnum arithmetic (cost 4) because:
;       The first argument is a INTEGER, not a FIXNUM.
;       The result is a (VALUES INTEGER &amp;OPTIONAL), not a (VALUES FIXNUM &amp;REST T).
;       unable to do inline (signed-byte 64) arithmetic (cost 5) because:
;       The first argument is a INTEGER, not a (SIGNED-BYTE 64).
;       The result is a (VALUES INTEGER &amp;OPTIONAL), not a (VALUES
;                                                          (SIGNED-BYTE 64) &amp;REST
;                                                          T).
;       etc.

;     (* DEN K2)
; 
; note: forced to do GENERIC-* (cost 30)
;       unable to do inline fixnum arithmetic (cost 4) because:
;       The first argument is a INTEGER, not a FIXNUM.
;       The result is a (VALUES INTEGER &amp;OPTIONAL), not a (VALUES FIXNUM &amp;REST T).
;       unable to do inline (signed-byte 64) arithmetic (cost 5) because:
;       The first argument is a INTEGER, not a (SIGNED-BYTE 64).
;       The result is a (VALUES INTEGER &amp;OPTIONAL), not a (VALUES
;                                                          (SIGNED-BYTE 64) &amp;REST
;                                                          T).
;       etc.

;     (* NUM K)
; 
; note: forced to do GENERIC-* (cost 30)
;       unable to do inline fixnum arithmetic (cost 4) because:
;       The first argument is a INTEGER, not a FIXNUM.
;       The result is a (VALUES INTEGER &amp;OPTIONAL), not a (VALUES FIXNUM &amp;REST T).
;       unable to do inline (signed-byte 64) arithmetic (cost 5) because:
;       The first argument is a INTEGER, not a (SIGNED-BYTE 64).
;       The result is a (VALUES INTEGER &amp;OPTIONAL), not a (VALUES
;                                                          (SIGNED-BYTE 64) &amp;REST
;                                                          T).
;       etc.

; compiling (DEFUN MAIN ...)
; file: /home/dunham/8000-benchmarksgame/bench/pidigits/pidigits.sbcl-3.sbcl
; in: DEFUN MAIN
;     (&gt; NUM ACC)
; 
; note: forced to do GENERIC-&gt; (cost 10)
;       unable to do inline fixnum comparison (cost 4) because:
;       The first argument is a INTEGER, not a FIXNUM.
;       The second argument is a INTEGER, not a FIXNUM.
; 
; compilation unit finished
;   printed 12 notes


; wrote /home/dunham/benchmarksgame_quadcore/pidigits/tmp/pidigits.sbcl-3.fasl
; compilation finished in 0:00:00.140
### START pidigits.sbcl-3.sbcl_run
(main) (quit)
### END pidigits.sbcl-3.sbcl_run


5.10s to complete and log all make actions

COMMAND LINE:
/opt/src/sbcl-1.4.13/bin/sbcl  --noinform --core sbcl.core --userinit /dev/null --load pidigits.sbcl-3.sbcl_run 27

UNEXPECTED OUTPUT 

3c3
&lt; 6264338
\ No newline at end of file
---
&gt; 6264338   	:27

PROGRAM OUTPUT:
3141592653	:10
5897932384	:20
6264338    </pre>
  </section>
</article>
<footer>
  <nav>
    <ul>
      <li><a href="../license.html"><span>3-Clause BSD License</span></a>
    </ul>
  </nav>
</footer>

